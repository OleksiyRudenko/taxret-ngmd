<!DOCTYPE html>
<html lang="en" >
  <head>
    <title>Податкова декларація</title>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />

    <!-- SWITCH VENDOR fw/lib css - EXTERNAL ON PRODUCTION -->
      <!-- fonts.googleapis -->
          <link rel='stylesheet' href='http://fonts.googleapis.com/css?family=Roboto:400,500,700,400italic'>
      <!-- angular-material.css -->
          <!-- local dev  >
            <link rel="stylesheet" href="../node_modules/angular-material/angular-material.css"/ -->
          <!-- local dev manual -->
            <link rel="stylesheet" href="../vendor/angular-material.1.0.6.min.css"/>
          <!-- local production >
            <link rel="stylesheet" href="csslib/angular-material.1.0.6.min.css"/ -->
          <!-- remote production >
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/angular-material/1.0.6/angular-material.min.css"/ -->

    <!-- APP - LOCAL ON PRODUCTION -->
        <link rel="stylesheet" href="./assets/app.css"/>
        <style type="text/css">
            /**
             * Hide when Angular is not yet loaded and initialized
             */
            [ng\:cloak], [ng-cloak], [data-ng-cloak], [x-ng-cloak], .ng-cloak, .x-ng-cloak {
              display: none !important;
            }
        </style>

  </head>

  <body ng-app="taxretApp" layout="row" ng-controller="AppController as appct" ng-cloak >

  <!-- A. Sidenav. Menu-button if port width > 960px (gt-sm) -->
  <md-sidenav class="site-sidenav md-sidenav-left md-whiteframe-z2"
      md-component-id="left"
      ng-click="appct.toggleSideNav()" aria-label="Show Side Navigation"
      md-is-locked-open="$mdMedia('gt-sm')">

    <md-toolbar class="md-whiteframe-z1">
        <div layout-gt-sm="row">
            <md-button style="text-align:left;" ui-sref="declarants">
                <md-icon md-svg-icon="{{appct.userService.getDeclarantCurrent().avatarid}}" class="avatar"></md-icon>
                {{appct.userService.getDeclarantCurrent().nameShort()}}
            </md-button>
            <md-button class="md-fab md-mini md-primary" md-no-ink ng-click="appct.makeContact(appct.userService.getDeclarantCurrent())"
                       aria-label="Зв'язатись з {{ appct.userService.getDeclarantCurrent().nameShort()}}">
                <md-tooltip>Зв'язатись з: {{appct.userService.getDeclarantCurrent().nameShort()}}</md-tooltip>
                <md-icon md-svg-icon="share"></md-icon>
            </md-button>
        </div>
    </md-toolbar>

      <div layout="column">
      <md-list>
          <md-list-item ng-repeat="state in appct.states">
              <md-divider ng-if="state.hr===true"></md-divider>
              <md-button ui-sref="{{state.sref}}" ng-class="{'selected' : $state.current.url === '#/' + state.sref }"
                      style="width:100%; text-align: left;"> <!-- ERR ng-class doesn't work -->
                                                            <!-- ERR button isn't 100% wide w/out style -->
                  <!-- a ui-sref="{{state.sref}}" -->{{state.title}}<!-- /a -->
              </md-button>
          </md-list-item>
      </md-list>
      </div>

    <!-- md-list>
      <md-list-item ng-repeat="it in appct.users">
          <md-button ng-click="appct.selectUser(it)" ng-class="{'selected' : it === appct.userService.getDeclarantCurrent() }">
            <md-icon md-svg-icon="{{it.avatarid}}" class="avatar"></md-icon>
            {{it.nameFirst+ ' ' +it.nameLast}}
          </md-button>
      </md-list-item>
    </md-list -->

  </md-sidenav>


  <!-- A. Major content block -->
  <div flex layout="column" tabIndex="-1" role="main" class="md-whiteframe-z2">

    <md-toolbar layout="row" class="md-whiteframe-z1">
      <md-button id="main" class="menu" hide-gt-sm ng-click="appct.toggleSideNav()" aria-label="Show User List">
        <md-icon md-svg-icon="menu" ></md-icon>
      </md-button>
      <h3 class="md-display-1">
          <a ng-href="http://oleksiyrudenko.github.io/taxret-ngmd/app/" class="nodecor" target="_blank">
              Податкова декларація
          </a>
      </h3>
    </md-toolbar>

    <md-content flex id="content">
        <div ui-view></div>
    </md-content>

      <!-- bottom-sheet show-up controlled by UserController::makeContact, which uses template './src/users/view/contactSheet.html' -->
  </div>

  <!-- SWITCH VENDOR fw/lib - EXTERNAL ON PRODUCTION -->
    <!-- angular family -->
      <!-- local dev  >
          <script type="text/javascript" src="../node_modules/angular/angular.js"></script>
          <script type="text/javascript" src="../node_modules/angular-animate/angular-animate.js"></script>
          <script type="text/javascript" src="../node_modules/angular-aria/angular-aria.js"></script>
          <script type="text/javascript" src="../node_modules/angular-material/angular-material.js"></script -->
          <!-- NOT AVAILABLE - USE REMOTE PRODUCTION: script type="text/javascript" src="../node_modules/angular-ui-router/release/angular-ui-router.js"></script -->
      <!-- local dev manual -->
          <script type="text/javascript" src="../vendor/angular.1.5.1.min.js"></script>
          <script type="text/javascript" src="../vendor/angular-animate.1.5.1.min.js"></script>
          <script type="text/javascript" src="../vendor/angular-aria.1.5.1.min.js"></script>
          <script type="text/javascript" src="../vendor/angular-resource.1.5.1.min.js"></script>
          <script type="text/javascript" src="../vendor/angular-material.1.0.6.min.js"></script>
          <script type="text/javascript" src="../vendor/angular-ui-router.0.2.18.min.js"></script>
          <script type="text/javascript" src="../vendor/api-check.7.5.5.min.js"></script>
          <script type="text/javascript" src="../vendor/formly.8.2.0.min.js"></script>
      <!-- local production >
          <script type="text/javascript" src="jslib/angular.1.5.1.min.js"></script>
          <script type="text/javascript" src="jslib/angular-animate.1.5.1.min.js"></script>
          <script type="text/javascript" src="jslib/angular-aria.1.5.1.min.js"></script>
          <script type="text/javascript" src="jslib/angular-material.1.0.6.min.js"></script>
          <script type="text/javascript" src="jslib/angular-ui-router.0.2.18.min.js"></script -->
      <!-- remote production >
          <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.1/angular.min.js"></script>
          <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.1/angular-animate.min.js"></script>
          <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.1/angular-aria.min.js"></script>
          <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.1/angular-resource.min.js"></script>
          <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular-material/1.0.6/angular-material.min.js"></script -->
          <!-- script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.18/angular-ui-router.min.js"></script -->

  <!-- VENDOR fw/lib - LOCAL ON PRODUCTION -->
      <script type="text/javascript" src="./vendor/lovefield.(160411).min.js"></script>
      <script type="text/javascript" src="./vendor/ng-lovefield.(160301).min.js"></script>
      <script type="text/javascript" src="./vendor/marked.(150731).js"></script>
      <script type="text/javascript" src="./vendor/angular-marked.(151122).js"></script>
      <script type="text/javascript" src="./vendor/formly-material.0.14.1.min.js"></script>

  <!-- APP - LOCAL ON PRODUCTION -->
      <script src="./src/app/AppModule.js"></script>
      <script src="./src/app/AppController.js"></script>
      <script src="./src/app/AppService.js"></script>
      <script src="./src/users/Users.js"></script>
      <script src="./src/users/UserController.js"></script>
      <script src="./src/users/UserService.js"></script>
      <script src="./src/users/UserAvaGridController.js"></script>

  <script type="text/javascript">

          angular
              .module('taxretApp', ['ngFormlyMaterial', 'ngMaterial', 'ui.router', 'app', 'users', 'hc.marked', 'kutomer.ng-lovefield']) // , 'formlyMaterial'])
              .config(function($mdThemingProvider, $mdIconProvider){

                  $mdIconProvider
                      .defaultIconSet(     "./assets/svg/avatars.svg", 128)
                      .icon("menu"       , "./assets/svg/menu.svg"        , 24)
                      .icon("share"      , "./assets/svg/share.svg"       , 24)
                      .icon("google_plus", "./assets/svg/google_plus.svg" , 512)
                      .icon("hangouts"   , "./assets/svg/hangouts.svg"    , 512)
                      .icon("twitter"    , "./assets/svg/twitter.svg"     , 512)
                      .icon("phone"      , "./assets/svg/phone.svg"       , 512)
                      .iconSet("avatarGrid", './assets/svg/avatars.svg', 128); // for UserAvaGridController */

                  $mdThemingProvider.theme('default')
                      .primaryPalette('indigo')
                      .accentPalette('light-blue')
                      .warnPalette('deep-orange');
                  $mdThemingProvider.theme('form-shaded')
                      .primaryPalette('orange')
                      .accentPalette('yellow')
                      .warnPalette('deep-orange')
                      //.backgroundPalette('grey')
                      .dark();
              })
              .config(function($stateProvider, $urlRouterProvider) {
                      //
                      // For any unmatched url, redirect to /state1
                      $urlRouterProvider.otherwise("/payroll");
                      //
                      // Now set up the states
                      $stateProvider
                              .state('declarants', {
                                  url: "/declarants",
                                  templateUrl: "src/users/view/declarants.html",
                                  controller: 'AppController', /* function($scope) {
                                      $scope.items = ["A", "List", "Of", "Items"];
                                  } */
                                  controllerAs: 'userct'
                              })
                              .state('payroll', {
                                  url: "/payroll",
                                  templateUrl: "src/workflowMain/personalIncome/payroll.html"
                              })
                              /* .state('state1.list', {
                                  url: "/list",
                                  templateUrl: "partials/state1.list.html",
                                  controller: function($scope) {
                                      $scope.items = ["A", "List", "Of", "Items"];
                                  }
                              }) */
                              .state('transport', {
                                  url: "/transport",
                                  templateUrl: "src/workflowMain/transportationMeans/transport.html"
                              })
                              .state('realestate', {
                                  url: "/realestate",
                                  templateUrl: "src/workflowMain/realEstate/realestate.html"
                              })
                              .state('funds', {
                                  url: "/funds",
                                  templateUrl: "src/workflowMain/stocks/stocks.html"
                              })
                              .state('foreignfee', {
                                  url: "/foreignfee",
                                  templateUrl: "src/workflowMain/foreignIncome/foreignfee.html"
                              })
                              .state('entrepreneur', {
                                  url: "/entrepreneur",
                                  templateUrl: "src/workflowMain/entrepreneuralIncome/entrepreneur.html"
                              })
                              .state('expenseexempt', {
                                  url: "/expenseexempt",
                                  templateUrl: "src/workflowMain/taxExempt/expenseexempt.html"
                              })
                              .state('docUserManual', {
                                  url: "/docUserManual",
                                  templateUrl: "src/manuals/docUserManual.html"
                              })
                              .state('docAbout', {
                                  url: "/docAbout",
                                  templateUrl: "src/manuals/docAbout.html"
                              })
                              .state('docDev', {
                                  url: "/docDev",
                                  templateUrl: "src/manuals/docDev.html"
                              })
              })
              .config(['lovefieldProvider',
                  function(lovefieldProvider) {
                      var schemaBuilder = lovefieldProvider.create('taxret', 1); // DataBase

                      schemaBuilder.createTable('ePerson').
                          addColumn('id', lovefieldProvider.Type.INTEGER).
                          addColumn('isActive', lovefieldProvider.Type.BOOLEAN).
                          addColumn('nameLast', lovefieldProvider.Type.STRING).
                          addColumn('nameFirst', lovefieldProvider.Type.STRING).
                          addColumn('namePat', lovefieldProvider.Type.STRING).
                          addColumn('isUAresident', lovefieldProvider.Type.BOOLEAN).
                          addColumn('status', lovefieldProvider.Type.STRING).
                          addColumn('passportNr', lovefieldProvider.Type.STRING).
                          addColumn('idUAtaxCode', lovefieldProvider.Type.INTEGER).
                          addColumn('idCodeSubst', lovefieldProvider.Type.STRING).
                          addColumn('addrCountry', lovefieldProvider.Type.STRING).
                          addColumn('addrRegion', lovefieldProvider.Type.STRING).
                          addColumn('addrDistrict', lovefieldProvider.Type.STRING).
                          addColumn('addrPO', lovefieldProvider.Type.STRING).
                          addColumn('addrCity', lovefieldProvider.Type.STRING).
                          addColumn('addrCityDistrict', lovefieldProvider.Type.STRING).
                          addColumn('addrStreet', lovefieldProvider.Type.STRING).
                          addColumn('addrBuilding', lovefieldProvider.Type.STRING).
                          addColumn('addrSubBuilding', lovefieldProvider.Type.STRING).
                          addColumn('addrApt', lovefieldProvider.Type.STRING).
                          addColumn('addrAptType', lovefieldProvider.Type.STRING).
                          addColumn('telNr', lovefieldProvider.Type.STRING).
                          addColumn('email', lovefieldProvider.Type.STRING).
                          addColumn('avatarid', lovefieldProvider.Type.STRING).
                          addColumn('comment', lovefieldProvider.Type.STRING).
                          addPrimaryKey(['id']);
                  }]
              )
              .config(['markedProvider', function (markedProvider) {
                  markedProvider.setOptions({gfm: true, tables: true, });
                  markedProvider.setRenderer({
                      link: function (href, title, text) {
                          return "<a href='" + href + "'" + (title ? " title='" + title + "'" : '') + " target='_blank'>" + text + "</a>";
                      }
                  });
              }])
              // !!!! formlyMaterial seems to be not working, at least with Angular 1.5.1
              // The following code is taken from http://jsbin.com/ximiheweka/edit?html,js,output
              // which is referred by author of https://github.com/formly-js/angular-formly-templates-material
              .run(function(formlyConfig) {
                  formlyConfig.setType({
                      name: 'input',
                      template: '<input ng-model="model[options.key]">'
                  });

                  formlyConfig.setType({
                      name: 'checkbox',
                      template: '<md-checkbox ng-model="model[options.key]">{{to.label}}</md-checkbox>'
                  });

                  formlyConfig.setWrapper({
                      name: 'mdLabel',
                      types: ['input'],
                      template: '<label>{{to.label}}</label><formly-transclude></formly-transclude>'
                  });

                  formlyConfig.setWrapper({
                      name: 'mdInputContainer',
                      types: ['input'],
                      template: '<md-input-container><formly-transclude></formly-transclude></md-input-container>'
                  });

                  // having trouble getting icons to work.
                  // Feel free to clone this jsbin, fix it, and make a PR to the website repo: https://github.com/formly-js/angular-formly-website
                  formlyConfig.templateManipulators.preWrapper.push(function(template, options) {
                      if (!options.data.icon) {
                          return template;
                      }
                      return '<md-icon class="step" md-font-icon="icon-' + options.data.icon + '"></md-icon>' + template;
                  });
              });  // eof formlyConfig

    </script>

  </body>
</html>
